import bpy, bmesh

dmk_string = 'DM_Mask'
dmk_flag = True

mk_string = 'm_Mask'
mk_flag = True 

bpy.context.scene.frame_set(1)

#######################################################

for collection in bpy.data.collections:
   if collection.name == dmk_string:
        dmk_flag = False
        print('collection already exist')
        break
            
if dmk_flag:
    dmk = bpy.data.collections.new(dmk_string)
    bpy.context.scene.collection.children.link(dmk)
        
    layer_collection = bpy.context.view_layer.layer_collection.children[dmk.name]
    bpy.context.view_layer.active_layer_collection = layer_collection

####################################################### 
       
vertsData = []
facesData = [( 10, 151, 108), ( 10, 108, 109), (109, 108,  69), (109,  69,  67), ( 67,  69, 104),
             ( 67, 104, 103), (103, 104,  68), (103,  68,  54), ( 54,  68,  71), ( 54,  71,  21), 
             ( 21,  71, 139), ( 21, 139, 162), (162, 139,  34), (162,  34, 127), (127,  34, 227), 
             (127, 227, 234), (234, 227, 137), (234, 137,  93), ( 93, 137, 177), ( 93, 177, 132),
             (132, 177,  58), ( 58, 177, 215), ( 58, 215, 172), (172, 215, 138), (172, 138, 136), 
             (136, 138, 135), (136, 135, 150), (150, 169, 149), (150, 135, 169), (149, 169, 170), 
             (149, 170, 140), (149, 140, 176), (176, 140, 171), (176, 171, 148), (148, 171, 152),
             (152, 171, 175), (152, 175, 396), (152, 396, 377), (377, 396, 400), (400, 396, 369),
             (400, 369, 378), (378, 369, 395), (378, 395, 394), (378, 394, 379), (379, 394, 364), 
             (379, 364, 365), (365, 364, 367), (365, 367, 397), (397, 367, 435), (397, 435, 288),
             (288, 435, 401), (288, 401, 361), (361, 401, 323), (323, 401, 366), (323, 366, 454), 
             (454, 366, 447), (454, 447, 356), (356, 447, 264), (356, 264, 389), (389, 264, 368), 
             (389, 368, 251), (251, 368, 301), (251, 301, 284), (284, 301, 298), (284, 298, 332), 
             (332, 298, 333), (332, 333, 297), (297, 333, 299), (297, 299, 338), (338, 299, 337),
             (338, 337,  10), ( 10, 337, 151),
             
             #######################################################
             (151,   9, 107), (151, 107, 108), (108, 107,  66), (108,  66,  69), ( 69,  66, 105),
             ( 69, 105, 104), (104, 105,  63), (104,  63,  68), ( 68,  63,  70), ( 68,  70,  71),
             ( 71,  70, 156), ( 71, 156, 139), (139, 156, 143), (139, 143,  34), ( 34, 143, 116),
             ( 34, 116, 227), (227, 116, 123), (227, 123, 137), (137, 147, 177), (137, 123, 147), 
             (177, 147, 213), (177, 213, 215), (215, 213, 192), (215, 192, 138), (135, 192, 214),
             (135, 138, 192), (135, 214, 210), (135, 210, 169), (169, 210, 170), (170, 210, 211),
             (170, 211,  32), (170,  32, 140), (140,  32, 208), (140, 208, 171), (171, 208, 175),
             (175, 208, 199), (175, 199, 428), (175, 428, 396), (396, 428, 369), (369, 428, 262),
             (369, 262, 395), (395, 262, 431), (395, 431, 430), (395, 430, 394), (394, 430, 364),
             (364, 430, 434), (364, 434, 416), (364, 416, 367), (367, 416, 435), (435, 416, 433),
             (435, 433, 401), (401, 433, 376), (401, 376, 366), (366, 376, 352), (366, 352, 447),
             (447, 352, 345), (447, 345, 264), (264, 345, 372), (264, 372, 368), (368, 372, 383),
             (368, 383, 301), (301, 383, 300), (301, 300, 298), (298, 300, 293), (298, 293, 333),
             (333, 293, 334), (333, 334, 299), (299, 334, 296), (299, 296, 337), (337, 296, 336),
             (337, 336, 151), (151, 336,   9),
             
             #######################################################
             (  9,   8,  55), (  9,  55, 107), (107,  55,  65), (107,  65,  66), ( 66,  65,  52),
             ( 66,  52, 105), (105,  52,  53), (105,  53,  63), ( 63,  53,  46), ( 63,  46,  70), 
             ( 70,  46, 124), ( 70, 124, 156), (156, 124,  35), (156,  35, 143), (143,  35, 111), 
             (143, 111, 116), (116, 111, 117), (116, 117, 123), (123, 117,  50), (147, 123, 187),
             (187, 123,  50), (187,  50, 205), (187, 205, 207), (213, 147, 192), (192, 147, 187), 
             (192, 187, 207), (192, 207, 214), (214, 207, 216), (214, 216, 212), (210, 214, 212),
             (210, 212, 202), (210, 202, 211), (211, 202, 204), (211, 204, 194), (211, 194,  32),
             ( 32, 194, 201), ( 32, 201, 208), (208, 201, 200), (208, 200, 199), (199, 200, 428),
             (428, 200, 421), (428, 421, 262), (262, 421, 418), (262, 418, 431), (431, 418, 424),
             (431, 424, 422), (431, 422, 430), (430, 422, 432), (430, 432, 434), (434, 432, 436),
             (434, 436, 427), (434, 427, 416), (416, 427, 411), (411, 425, 280), (411, 427, 425),
             (416, 411, 376), (416, 376, 433), (376, 411, 352), (411, 280, 352), (352, 280, 346), 
             (352, 346, 345), (345, 346, 340), (345, 340, 372), (372, 340, 265), (372, 265, 383), 
             (383, 265, 353), (383, 353, 300), (300, 353, 276), (293, 300, 276), (293, 276, 283), 
             (334, 293, 283), (334, 283, 282), (296, 334, 282), (296, 282, 295), (296, 295, 336), 
             (336, 295, 285), (336, 285,   9), (  9, 285,   8), ( 36, 206, 205), ( 36, 203, 206), 
             (426, 266, 425), (423, 266, 426), (425, 427, 426), (426, 427, 436), (207, 205, 206), 
             (207, 206, 216), (101,  36, 205), (101, 205,  50), (266, 330, 425), (425, 330, 280),
             (118, 101,  50), (117, 118,  50), (330, 347, 280), (280, 347, 346), (118, 119, 101),
             (101, 119, 100), ( 36, 101, 100), ( 36, 100, 142), ( 36, 142, 129), ( 36, 129, 203),
             (203, 129,  98), (348, 347, 330), (348, 330, 329), (329, 330, 266), (329, 266, 371),
             (371, 266, 358), (358, 266, 423), (358, 423, 327), (100, 126, 142), (355, 329, 371),
             (245, 114, 128), (128, 114, 121), (121, 114,  47), (121,  47, 120), (120,  47, 100),
             (120, 100, 119), (114, 217,  47), ( 47, 217, 126), ( 47, 126, 100), (343, 465, 357),
             (343, 357, 350), (343, 350, 277), (277, 350, 349), (277, 349, 329), (329, 349, 348), 
             (437, 343, 277), (437, 277, 355), (355, 277, 329), (217, 198, 126), (126, 198, 209),
             (126, 209, 142), (209, 198,  49), (129, 142, 209), (129, 209,  49), (129,  49, 102),
             ( 64, 129, 102), ( 98, 129,  64), ( 98,  64, 240), ( 97,  98, 240), (420, 437, 355),
             (429, 420, 355), (429, 355, 371), (279, 420, 429), (358, 279, 429), (358, 429, 371),
             (279, 358, 331), (331, 358, 294), (294, 358, 327), (460, 294, 327), (326, 460, 327), 
             
             ####################################################### eyes
             (193, 221,  55), (417, 285, 441), ( 55, 221, 222), (441, 285, 442), ( 55, 222,  65), 
             (442, 285, 295), ( 65, 222,  52), (442, 295, 282), ( 52, 222, 223), (442, 282, 443), 
             ( 52, 223, 224), ( 52, 224,  53), ( 53, 224, 225), ( 53, 225,  46), ( 46, 225, 113), 
             (443, 282, 444), (444, 282, 283), (444, 283, 445), (445, 283, 276), (445, 276, 342),
             ( 46, 113, 124), (124, 113, 226), (124, 226,  35), ( 35, 226,  31), ( 35,  31, 111), 
             (342, 276, 353), (342, 353, 446), (446, 353, 265), (261, 446, 265), (261, 265, 340),
             (111,  31, 117), (117,  31, 228), (117, 228, 118), (118, 228, 229), (118, 229, 119), 
             (261, 340, 346), (261, 346, 448), (448, 346, 347), (448, 347, 449), (449, 347, 348),
             (119, 229, 230), (119, 230, 120), (120, 230, 231), (120, 231, 121), (121, 231, 232), 
             (121, 232, 128), (128, 232, 233), (128, 233, 244), (128, 244, 245), (245, 244, 189),
             (449, 348, 450), (348, 349, 450), (450, 349, 451), (451, 349, 350), (451, 350, 452), 
             (452, 350, 357), (452, 357, 453), (453, 357, 464), (464, 357, 465), (464, 465, 413),
             (245, 189, 193), (189, 221, 193), (465, 417, 413), (413, 417, 441), (244, 243, 190), 
             (244, 190, 189), (190,  56, 189), (189,  56, 221), (221,  56, 222), (464, 414, 463), 
             (464, 413, 414), (414, 413, 286), (286, 413, 441), (286, 441, 442), (244, 233, 243), 
             (243, 233, 112), (112, 233, 232), (112, 232,  26), ( 26, 232,  22), (464, 463, 453), 
             (453, 463, 341), (453, 341, 452), (452, 341, 256), (452, 256, 252), (232, 231,  22),
             (452, 252, 451), ( 22, 231,  23), ( 23, 231, 230), (451, 252, 253), (451, 253, 450),
             (222,  56,  28), (222,  28, 223), (223,  28,  27), (223,  27,  29), (223,  29, 224),
             (286, 442, 258), (258, 442, 443), (258, 443, 257), (257, 443, 259), (259, 443, 444),
             (224,  29,  30), (224,  30, 225), (225,  30, 247), (225, 247, 113), (113, 247, 130),
             (444, 260, 259), (260, 444, 445), (260, 445, 467), (467, 445, 342), (467, 342, 359),
             (359, 342, 446), (255, 359, 446), (113, 130, 226), (226, 130,  25), ( 31, 226,  25), 
             (228,  31,  25), (228,  25, 110), (110, 229, 228), (229, 110,  24), (229,  24, 230), 
             (230,  24,  23), (261, 255, 446), (448, 255, 261), (448, 339, 255), (449, 339, 448), 
             (449, 254, 339), (450, 254, 449), (450, 253, 254), (451, 253, 450), (451, 252, 253),
             (243, 133, 173), (398, 362, 463), (243, 173, 190), (398, 463, 414), (190, 173, 157),
             (384, 398, 414), ( 56, 190, 157), (286, 384, 414), (133, 243, 112), (133, 112, 155),
             (362, 341, 463), (382, 341, 362), (155, 112,  26), (155,  26, 154), (382, 256, 341), 
             (382, 381, 256), ( 56, 157, 158), ( 56, 158,  28), (286, 385, 384), (286, 258, 385),
             (154,  26,  22), (154,  22, 153), (381, 252, 256), (381, 380, 252), ( 28, 158, 159),
             ( 28, 159,  27), (258, 386, 385), (258, 257, 386), (153,  22,  23), (153,  23, 145),
             (380, 253, 252), (380, 374, 253), ( 27, 159,  29), ( 29, 159, 160), ( 29, 160,  30),
             (257, 259, 386), (259, 387, 386), (259, 260, 387), ( 30, 160, 161), (387, 260, 388),
             (145,  23, 144), (144,  23,  24), (374, 373, 253), (373, 254, 253), ( 30, 161, 247),
             (247, 161, 246), (247, 246,  33), (247,  33, 130), (260, 467, 388), (388, 467, 466),
             (466, 467, 263), (263, 467, 359), (130,  33,  25), (263, 359, 255), ( 33,   7,  25), 
             (263, 255, 249), (144,  24, 110), (144, 110, 163), (163, 110,   7), (  7, 110,  25), 
             (373, 339, 254), (373, 390, 339), (339, 390, 249), (339, 249, 255), 
            
             #######################################################
             (  0,  11,  72), (  0,  72,  37), ( 37,  72,  39), ( 39,  72,  73), ( 39,  73,  40), 
             ( 40,  73,  74), ( 40,  74, 184), ( 40, 184, 185), (185, 184,  76), (185,  76,  61),
             (185,  61,  57), ( 57,  61, 146), (146,  61,  76), (146,  76,  77), (146,  77,  91),
             ( 91,  77,  90), ( 91,  90, 180), ( 91, 180, 181), (181, 180,  85), (181,  85,  84),
             ( 84,  85,  16), ( 84,  16,  17), ( 17,  16, 314), (314,  16, 315), (314, 315, 405),
             (405, 315, 404), (405, 404, 321), (321, 404, 320), (321, 320, 307), (321, 307, 375),
             (320, 325, 307), (307, 292, 306), (375, 307, 306), (375, 306, 291), (375, 291, 287),
             (287, 291, 409), (291, 306, 409), (306, 408, 409), (306, 292, 407), (306, 407, 408),
             (307, 325, 292), (409, 408, 270), (270, 408, 304), (270, 304, 303), (270, 303, 269),
             (269, 303, 302), (269, 302, 267), (267, 302,   0), (  0, 302,  11), ( 11,  12,  72),
             ( 72,  12,  38), ( 72,  38,  73), ( 73,  38,  41), ( 73,  41,  74), ( 74,  41,  42),
             ( 74,  42, 184), (184,  42, 183), (184, 183,  76), (183,  62,  76), ( 76,  62,  77),
             ( 77,  62,  96), ( 77,  96,  90), ( 90,  96,  89), ( 90,  89, 179), (180, 90,  179),
             (180, 179,  86), (180,  86,  85), ( 85,  86,  15), ( 85,  15,  16),( 16,  15,  315),
             (315,  15, 316), (315, 316, 404), (404, 316, 403), (404, 403, 320), (320, 403, 319),
             (320, 319, 325), (325, 308, 292), (292, 308, 407), (408, 407, 272), (408, 272, 304),
             (304, 272, 271), (304, 271, 303), (303, 271, 268), (303, 268, 302), (302, 268,  12),
             (302,  12,  11), ( 12,  13,  38), ( 38,  13,  82), ( 38,  82,  41), ( 41,  82,  81),
             ( 41,  81,  42), ( 42,  81,  80), ( 42,  80, 183), (183, 191,  78), (183,  78,  62),
             ( 80, 191, 183), ( 78,  96,  62), ( 95,  96,  78), ( 88,  96,  95), ( 88,  89,  96),
             ( 88, 179,  89), ( 88, 178, 179), (178,  87, 179), ( 87,  86, 179), ( 87,  14,  86),
             ( 14,  15,  86), ( 15,  14, 316), (316,  14, 317), (316, 317, 403), (403, 317, 402), 
             (403, 402, 318), (403, 318, 319), (319, 318, 325), (325, 318, 324), (325, 324, 308), 
             (308, 415, 292), (292, 308, 407), (308, 415, 407), (407, 415, 310), (407, 310, 272),
             (272, 310, 311), (272, 311, 271), (271, 311, 312), (271, 312, 268), (268, 312,  13),
             (268,  13,  12),
             
             #######################################################
             (164,   0,  37), (164,  37, 167), (167,  37,  39), (167,  39, 165), (165,  39,  92), 
             ( 92,  39,  40), ( 92,  40, 186), (186,  40, 185), (186, 185,  57), ( 43,  57, 146),
             ( 43, 146,  91), ( 43,  91, 106), (106,  91, 182), (182,  91, 181), (182, 181,  84),
             (182,  84,  83), ( 83,  84,  18), ( 18,  84,  17), ( 18,  17, 314), ( 18, 314, 313),
             (313, 314, 406), (406, 314, 405), (406, 405, 321), (406, 321, 335), (335, 321, 273),
             (273, 321, 375), (273, 375, 287), (287, 409, 410), (410, 409, 270), (270, 269, 322),
             (410, 270, 322), (269, 391, 322), (269, 393, 391), (269, 267, 393), (267, 164, 393), 
             (267,   0, 164), (186,  57, 212), (212,  57,  43), (287, 410, 432), (273, 287, 432),
             (212,  43, 202), (202,  43, 106), (204, 202, 106), (204, 106, 182), (194, 204, 182),
             (201, 194, 182), (201, 182,  83), (201,  83, 200), (200,  83,  18), (200,  18, 313), 
             (200, 313, 421), (421, 313, 406), (421, 406, 418), (418, 406, 424), (424, 406, 335),
             (424, 335, 422), (335, 273, 422), (422, 273, 432), (  2, 164,  97), (  2, 326, 164), 
             (164, 326, 393), ( 97, 164, 167), ( 97, 167,  98), (326, 327, 393), ( 98, 167, 165), 
             (393, 327, 391), (203,  98, 165), (391, 327, 423), (203, 165, 206), (391, 423, 426),
             (165,  92, 206), (206,  92, 216), (216,  92, 186), (216, 186, 212), (391, 426, 322),
             (322, 426, 436), (410, 322, 436), (410, 436, 432),
             
             ####################################################### noise
             (  8, 193,  55), (  8, 285, 417), (  8, 168, 193), (193, 168, 122), (  8, 417, 168), 
             (168, 417, 351), (168,   6, 122), (168, 351,   6), (193, 122, 245), (417, 465, 351), 
             (  6, 197, 196), (  6, 419, 197), (  6, 196, 122), (  6, 351, 419), (197, 195,   3), 
             (197, 248, 195), (197,   3, 196), (197, 419, 248), (195,   5,  51), (195, 281,   5), 
             (195,  51,   3), (195, 248, 281), (  5,   4,  45), (  5, 275,   4), (  5,  45,  51), 
             (  5, 281, 275), (  4,   1,  45), (  4, 275,   1), ( 45,   1,  44), (  1, 275, 274), 
             (  1,  19,  44), (  1, 274,  19), ( 44,  19, 125), ( 19, 274, 354), ( 19,  94, 125), 
             ( 19, 354,  94), (125,  94, 141), ( 94, 354, 370), ( 94,   2, 141), ( 94, 370,   2),
             (141,   2,  97), (  2, 370, 326), (125, 141, 241), (241, 141, 242), (241, 242, 238), 
             (238, 242,  20), (238,  20,  79), (354, 461, 370), (370, 461, 462), (462, 461, 458), 
             (462, 458, 250), (250, 458, 309), (141,  97, 242), (370, 462, 326), ( 44, 125, 241),
             ( 44, 241, 237), (274, 461, 354), (274, 457, 461), (241, 239, 237), (241, 238, 239),
             (238,  79, 239), (461, 459, 458), (461, 457, 459), (458, 459, 309), (237, 239, 218),
             (218, 239,  79), (457, 438, 459), (459, 438, 309), ( 45,  44, 220), (275, 440, 274),
             (220,  44, 237), (220, 237, 218), (220, 218, 115), (440, 457, 274), (440, 438, 457),
             (440, 344, 438), ( 51,  45, 134), (134,  45, 220), (134, 220, 131), (131, 220, 115), 
             (  3,  51, 236), (281, 363, 275), (275, 363, 440), (440, 363, 360), (440, 360, 344), 
             (248, 456, 281), (236,  51, 134), (198, 236, 134), (281, 456, 363), (363, 456, 420), 
             (198, 134, 131), (363, 420, 360), (114, 174, 217), (399, 343, 437), (217, 174, 198), 
             (399, 437, 420), (114, 188, 174), (399, 412, 343), (122, 196, 188), (351, 412, 419),
             (188, 196, 174), (412, 399, 419), (196,   3, 236), (196, 236, 174), (174, 236, 198), 
             (198, 131,  49), (419, 456, 248), (419, 399, 456), (399, 420, 456), (420, 279, 360),
             (351, 465, 412), (465, 343, 412), (245, 122, 188), (245, 188, 114), ( 99, 242,  97),
             (240,  99,  97), (326, 462, 328), (328, 460, 326), (131, 115,  48), (131,  48,  49), 
             (344, 360, 278), (278, 360, 279), (242,  99,  20), (462, 250, 328), (115, 218, 219), 
             (115, 219,  48), (438, 344, 439), (439, 344, 278), ( 48, 219,  64), (278, 294, 439), 
             ( 99, 240,  75), ( 99,  75,  60), ( 99,  60,  20), (328, 305, 460), (328, 290, 305),
             (328, 250, 290), ( 49,  48, 102), (102,  48,  64), (279, 331, 278), (278, 331, 294),
             ( 64, 219, 235), ( 64, 235, 240), (455, 439, 294), (455, 294, 460), (240, 235,  75), 
             (460, 305, 455), (439, 455, 289), (455, 305, 289), (235, 219,  59), (235,  59,  75), 
             (218,  79, 166), (309, 438, 392), (438, 439, 392), (218, 166, 219), (219, 166,  59), 
             (439, 289, 392), (392, 289, 305), (166,  75,  59),  
             #( 79,  20,  60), (250, 309, 290), ( 79,  60, 166), (309, 392, 290),  
             #(392, 305, 290), (166,  60,  75),
            ]

obj = bpy.context.scene.objects.get('m_Mask')
if obj: 
    mk_flag = False
    obj = bpy.context.scene.objects['m_Mask']
    bpy.context.view_layer.objects.active = obj
    obj.select_set(True)

if mk_flag: 
    
    for i in range(468):  
        str_empty = 'cgt_face_empty_'+ str(i)
        str_point = 'face_point_{:03}'.format(i)
        x = bpy.data.objects[str_empty].location[0]
        y = bpy.data.objects[str_empty].location[1]
        z = bpy.data.objects[str_empty].location[2]
        vertsData.append((x, y, z))
    
    mesh = bpy.data.meshes.new("m_mesh")
    mesh.from_pydata(vertsData, [], facesData)
    mesh.update()

    new_object = bpy.data.objects.new('m_Mask', mesh)
    new_object.data = mesh

    bpy.data.collections['DM_Mask'].objects.link(new_object)

    obj = bpy.context.scene.objects["m_Mask"]
    bpy.context.view_layer.objects.active = obj
    obj.select_set(True) 

#######################################################     
"""   
    for i in range(468):
        str_vertex = 'v_point_{:03}'.format(i)
        bpy.context.object.vertex_groups.new(name = str_vertex)      
        
        bpy.ops.object.mode_set(mode = 'EDIT') 
        bpy.ops.mesh.select_mode(type = "VERT")
        bpy.ops.mesh.select_all(action = 'DESELECT')
        
        bpy.ops.object.mode_set(mode = 'OBJECT')
        obj.data.vertices[i].select = True
        
        bpy.ops.object.mode_set(mode = 'EDIT')
        bpy.ops.object.vertex_group_assign()
        
    bpy.ops.mesh.select_all(action = 'DESELECT')
    bpy.ops.object.mode_set(mode = 'OBJECT')
    
"""
#######################################################

for i in range(100): 
    f = i * 5 + 4
    bpy.context.scene.frame_set(f)
    
    obj = bpy.context.scene.objects['m_Mask']
    bpy.context.view_layer.objects.active = obj
    obj.select_set(True) 
    
    bpy.ops.object.mode_set(mode = 'EDIT')
      
    bm = bmesh.from_edit_mesh(obj.data)
    j = 0
    for vert in bm.verts:
        str_empty = 'cgt_face_empty_'+ str(j)
        vert.co[0] = bpy.data.objects[str_empty].location[0]
        vert.co[1] = bpy.data.objects[str_empty].location[1]
        vert.co[2] = bpy.data.objects[str_empty].location[2]
        j = j + 1
        #print(vert.index, 'co.location:', vert.co.to_tuple())
  
    bpy.ops.object.mode_set(mode = 'OBJECT')
   
    bpy.ops.anim.insert_keyframe_animall()

#######################################################   

#bpy.ops.object.editmode_toggle()
#print(collection.name)             
